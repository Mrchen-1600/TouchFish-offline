# 🐟 TouchFish 用户手册

> **“工作再忙，也要学会优雅地休息。”**

欢迎使用 **TouchFish (摸鱼神器 - 离线版)**。本软件通过人工智能技术，为您提供“老板雷达”般的安全保护。

**两个注意事项**：

* **当前仅支持 windows 系统，MocOS 及 Linux 暂不适配；**
* **请保证你的文件目录中不存在中文，一个标准的目录参考：D:\\app\\TouchFish\\TouchFish.exe**

## ⚡ 3分钟快速上手

### 1. 安装与启动

* 本软件为**绿色免安装版**。
* 请务必将压缩包**完整解压**到一个文件夹中（例如 D盘），路径中务必保证无中文和特殊字符。
* **双击文件夹内的** **`TouchFish.exe`** 即可启动。
  * *⚠️ 注意：请勿删除文件夹内的 `model` 文件夹 或 其他配置文件，否则软件将无法正常运行。*

### 2. 必做配置（只需设置一次）

#### 📸 第一步：录入您的“面容ID”

> **软件需要知道“谁是主人”，否则出于安全考虑，摄像头将拒绝启动。**

1. 点击软件顶部的 **【视觉识别】** 选项卡。
2. 点击“我的照片”旁的 **【浏览...】** 按钮。
3. **选择一张您的照片（证件照、生活照均可，需五官清晰）。**
4. 点击底部的 **【保存配置】** 。

#### 🎭 第二步：设置“伪装现场”

> **当危险来临时，您希望电脑屏幕变成什么样？**

1. 点击 **【触发动作】** 选项卡。
2. **安全应用**：选择一个正经的工作软件（如 Word, Excel, 代码编辑器等）。
   * *效果*：警报触发时，该软件会自动弹窗全屏遮挡屏幕。
3. **备用网址**：用于在应用打开失败时的兜底策略，将自动打开你指定的备用网址。
4. **窗口处理**：可选择 **“最小化所有 (Win+D)”** 、 **“关闭当前（Alt + F4）”** 和 **“关闭所有”** 。
   * **最小化所有** ：将最小化你打开的所有页面，并全屏启动你设置的安全应用
   * **关闭当前**：仅关闭当前你打开的应用中当前选中的这个（例如：你正在访问谷歌浏览器，触发后仅关闭谷歌浏览器，不影响其他应用）
   * **关闭所有**：当你选择此项时，触发后，将关闭除了“摸鱼神器”以外的其他所有应用/网页，如果你不希望关闭某些应用进程，可以在白名单中添加。

## 🎛️ 进阶功能说明

### 👁️ 视觉监控设置

* **摄像头设备**：如果有多个摄像头，点击 **“测试/选择摄像头”** 按钮，可实时预览并切换。
* **检测画质(缩放)** ：
  * 电脑配置高？拉到 **0.8\~1.0**，识别超精准。
  * 电脑配置旧？拉到 **0.3\~0.5**，运行更流畅。
* **人脸容差**：数值越对，对你和其他人的人脸区分效果越好，但是相应的也越容易误判，比如如果这个设置到最低，可能你只是微微侧头，他就会把你识别为陌生人。
* **陌生人触发阈值**：默认为 1。数值越大，防误触能力越强，但反应越慢；数值越小，反应越快，但可能出现误判。
* **离席触发阈值**：默认为10。表示当你本人离开摄像头前多少帧就会触发安全应用切换。

### 👂 语音监听设置

**即使不联网，软件也能听懂暗号。**

* **触发关键词**：输入如 `老板,来了,开会`。【英文逗号分隔】
* **一旦麦克风听到这些词，立即触发保护。**

### ❄️ 关于“冷却模式”

为了防止电脑“抽风”，当保护触发后，软件会进入 **10秒冷却时间**。

* 在这10秒内，软件会**暂停监控**。
* **您可以用这段时间调整坐姿、关闭不需要的窗口，不用担心刚恢复窗口又被关掉。**

## ❓ 常见问题 (Q&A)

**Q: 为什么点击“启动监控”没反应，或者摄像头灯不亮？**

> **A**: 请检查日志区域。通常是因为**未设置本人照片**。软件必须加载照片后才会启动摄像头。

**Q: 为什么我坐在电脑前，它也报警说有“陌生人”？**

> **A**: 本软件采用**严格单人模式**。
>
> 1. **请检查身后是否有其他人（多人同框 = 危险）。**
> 2. **请检查光线是否太暗，或人脸容差设置过低。**

**Q: 语音功能提示“找不到模型”？**

> **A**: 请确认 `TouchFishPro.exe` 同级目录下存在 `model` 文件夹，且并未修改其内部结构。

**Q: 关闭软件时，为什么界面卡顿了一下？**

> **A**: 这是正常现象。后台的 AI 线程正在安全释放摄像头和麦克风资源，请耐心等待 1-2 秒。

**祝您摸鱼愉快，工作高效！ 🚀**

# TouchFish 项目技术文档

> **版本**: 1.1.2 (Stable)
>
> **更新日期**: 2026.01.13
>
> **开发者**: Mrchen-1600【尘小风】

## 1. 项目概述

**TouchFish** 是一款基于 Python 开发的高性能桌面隐私保护应用。它利用计算机视觉（CV）和离线语音识别（ASR）技术，实时监控用户周围环境。当检测到**陌生人出现在摄像头内**、**用户离席**或**特定语音暗号**时，系统将毫秒级响应，执行静音、隐藏窗口并自动打开伪装工作界面，为用户的“摸鱼”时光提供全方位保护。

## 2. 技术架构栈


| 模块         | 技术选型                   | 说明                                         |
| ------------ | -------------------------- | -------------------------------------------- |
| **GUI 框架** | `Tkinter`+`ttk`            | Python 原生界面库，轻量级，无额外 DLL 依赖。 |
| **视觉引擎** | `opencv-python-headless`   | 图像流捕获与预处理（Headless版减小体积）。   |
| **人脸识别** | `face_recognition`(`dlib`) | 基于 HOG 特征的高精度人脸比对算法。          |
| **语音引擎** | `Vosk`(Kaldi)              | 离线语音识别，隐私安全，无需联网，低延迟。   |
| **音频录制** | `PyAudio`                  | 跨平台音频流录制。                           |
| **系统控制** | `ctypes`/`pyautogui`       | Windows API 调用（静音）及键盘模拟。         |
| **打包部署** | `PyInstaller`              | 深度定制 Spec 文件，支持二进制资源嵌入。     |

## 3. 核心算法逻辑

### 3.1 视觉监控：严格单人模式

为了杜绝“老板站在身后一起看屏幕”的漏判情况，我们采用了严格单人的检测逻辑：

1. **图像预处理**：支持动态分辨率缩放（Scale 0.25\~1.0），在性能与识别率之间取得平衡。
2. **逻辑判定树**：
   * **Case A (0人)**: 判定为 `Absence` (离席)。
   * **Case B (>1人)**: 判定为 `Stranger` (危险)。即使其中一人是用户，只要有多人同框即报警。
   * **Case C (=1人)**: 提取特征向量，计算欧氏距离。
     * 距离 < Tolerance: 判定为 `Safe` (安全)。
     * 距离 > Tolerance: 判定为 `Stranger` (危险)。

### 3.2 语音监控：非阻塞热词唤醒

* **架构**：采用 `Producer-Consumer` 模型。音频采集与识别在独立的守护线程 (`Daemon Thread`) 中运行，不阻塞主 GUI 渲染和视频流处理。
* **模型**：集成 Vosk Small 中文模型，支持约 0.5 秒的快速推断。

### 3.3 冷却机制 (Cooling Down)

* 触发保护后，系统强制挂起监控线程 **10秒**。
* **目的**：防止因环境持续不安全导致的“窗口鬼畜开关”和 CPU 资源浪费，给予用户缓冲时间。

## 4. 项目结构

```
TouchFish/
├── main_gui.py           # [Core] UI主线程、监控线程管理器
├── settings_manager.py   # [Config] 配置持久化与热更新
├── build.spec            # [Build] 深度定制的打包配置
├── logo.ico              # 资源文件
├── model/                # Vosk 语音模型库
└── modules/              # 功能微服务
    ├── actions.py        # 动作执行器
    ├── audio.py          # 语音识别器
    └── vision.py         # 视觉分析器
```

## 5. 常见安装问题及解决方案

### **`dlib` 安装失败**：

`face-recognition` 依赖 `dlib`，而 `dlib` 在 Windows 上直接 pip 安装可能需要 Visual Studio C++ 编译环境。
**解决办法**：如果报错，请去网上下载对应你 Python 版本的 `dlib.whl` 文件（预编译包），然后通过 `pip install dlib_xxx.whl` 手动安装。
